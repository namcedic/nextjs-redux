(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{6709:function(e,r,o){Promise.resolve().then(o.bind(o,7479))},7479:function(e,r,o){"use strict";o.r(r),o.d(r,{default:function(){return L}});var n=o(7437),s=o(6087),t=o.n(s),a=o(2265),l=o(828),c=o(5972),i=o(879),u=o(9890),d=o(146),h=o(3571),f=o(7963);let p=o(3107).Z.create({baseURL:"".concat("http://localhost:3001"),timeout:2e4}),y=async(e,r)=>await p.post("/auth/login",{email:e,password:r}),k=async()=>await p.post("/auth/logout"),g=async e=>await p.post("/auth/register",e),m=async e=>await p.post("/auth/refresh-token",e);function*T(e){try{let{accessToken:r,refreshToken:o}=(yield(0,u.RE)(y,e.payload.email,e.payload.password)).data;d.Z.set("accessToken",r,{expires:7}),d.Z.set("refreshToken",o,{expires:30}),localStorage.setItem("accessToken",r),localStorage.setItem("refreshToken",o),d.Z.set("authToken",r);let n=(0,f.o)(r),s={id:n.sub,email:n.email};yield(0,u.gz)((0,h.he)({user:s,accessToken:r,refreshToken:o})),e.payload.cb&&e.payload.cb({success:!0})}catch(s){var r,o;let n=(null===(o=s.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"An unknown error occurred";yield(0,u.gz)((0,h.UR)(n)),e.payload.cb&&e.payload.cb({success:!1,error:n})}}function*v(e){try{let{success:r}=(yield(0,u.RE)(g,e.payload.payload)).data;e.payload.cb&&e.payload.cb({success:r})}catch(s){var r,o;let n=(null===(o=s.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"An unknown error occurred";yield(0,u.gz)((0,h.UR)(n)),e.payload.cb&&e.payload.cb({success:!1,error:n})}}function*b(e){try{let{accessToken:r,refreshToken:o}=(yield(0,u.RE)(m,e.payload.payload)).data;return e.payload.cb&&e.payload.cb({accessToken:r,refreshToken:o}),{accessToken:r,refreshToken:o}}catch(s){var r,o;let n=(null===(o=s.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"An unknown error occurred";yield(0,u.gz)((0,h.UR)(n)),e.payload.cb&&e.payload.cb({accessToken:"",refreshToken:"",error:n})}}function*x(){try{yield(0,u.RE)(k)}catch(e){console.error("Logout API failed, proceeding with client-side logout.",e)}finally{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),d.Z.remove("accessToken"),d.Z.remove("refreshToken"),d.Z.remove("authToken"),yield(0,u.gz)((0,h.ls)())}}function*j(){yield(0,u.$6)([function*(){yield(0,u.Fm)(h.Qb.type,T),yield(0,u.Fm)(h.bj.type,v),yield(0,u.Fm)(h.Tz.type,x),yield(0,u.Fm)(h.zF.type,b)}()])}let R=(0,i.ZP)(),w=()=>{let e=(0,c.xC)({middleware:e=>e().concat(R),reducer:{auth:h.ZP}});return R.run(j),e},S=e=>{let{children:r}=e,o=(0,a.useRef)();return o.current||(o.current=w()),(0,n.jsx)(l.zt,{store:o.current,children:r})};var Z=o(5625),z=o(9750),I=o(7078),A=o(5588),F=o(8792),N=o(7907);let{Text:P}=z.default,C=()=>{let e=(0,Z.TL)(),r=(0,N.useRouter)(),{isAuthenticated:o,user:s}=(0,Z.CG)(e=>e.auth);return(0,n.jsxs)("header",{className:"header-bar",children:[(0,n.jsx)(F.default,{href:"/",passHref:!0,children:(0,n.jsx)(P,{strong:!0,style:{fontSize:"20px",cursor:"pointer"},children:"Cedric App"})}),(0,n.jsx)("div",{children:o&&s?(0,n.jsxs)("div",{className:"user-info",children:[(0,n.jsxs)("p",{children:["Welcome ",s.email,"!"]}),(0,n.jsx)(A.ZP,{type:"primary",onClick:()=>{e((0,h.Tz)()),r.push("/login"),I.ZP.success({message:"Logout successful!"})},children:"Logout"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F.default,{href:"/login",passHref:!0,children:(0,n.jsx)(A.ZP,{type:"primary",className:"primary",children:"Login"})}),(0,n.jsx)(F.default,{href:"/register",passHref:!0,children:(0,n.jsx)(A.ZP,{type:"link",children:"Register"})})]})})]})};o(6403);let E=e=>{let{children:r}=e,o=(0,Z.qr)(),s=(0,Z.TL)();return(0,a.useEffect)(()=>{(async()=>{let e=localStorage.getItem("accessToken"),r=localStorage.getItem("refreshToken");if(console.log(e,r,"accessToken, refreshToken"),e&&r)try{let n=(0,f.o)(e),t=Date.now()/1e3;if(n.exp<t)s((0,h.zF)({payload:{refreshToken:r},cb:e=>{if(e.accessToken){localStorage.setItem("accessToken",e.accessToken),e.refreshToken&&localStorage.setItem("refreshToken",e.refreshToken);let n=(0,f.o)(e.accessToken),s={id:n.sub,email:n.email};o.dispatch((0,h.WN)({user:s,accessToken:e.accessToken,refreshToken:e.refreshToken||r}))}else console.error("Refresh token failed, logging out"),localStorage.removeItem("accessToken")}}));else{let s={id:n.sub,email:n.email};o.dispatch((0,h.WN)({user:s,accessToken:e,refreshToken:r}))}}catch(e){console.error("Auth error:",e),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login"}})()},[o]),(0,n.jsx)(n.Fragment,{children:r})};function L(e){let{children:r}=e;return(0,n.jsx)("html",{lang:"en",children:(0,n.jsx)("body",{className:t().className,children:(0,n.jsx)(S,{children:(0,n.jsxs)(E,{children:[(0,n.jsx)(C,{}),(0,n.jsx)("main",{children:r})]})})})})}},3571:function(e,r,o){"use strict";o.d(r,{Qb:function(){return s},Tz:function(){return i},UR:function(){return a},WN:function(){return d},bj:function(){return l},he:function(){return t},ls:function(){return u},zF:function(){return c}});let n=(0,o(5972).oM)({name:"auth",initialState:{isAuthenticated:!1,user:null,accessToken:null,refreshToken:null,loading:!1,error:null},reducers:{loginRequest:(e,r)=>{e.loading=!0,e.error=null},loginSuccess:(e,r)=>{e.isAuthenticated=!0,e.loading=!1,e.user=r.payload.user,e.accessToken=r.payload.accessToken,e.refreshToken=r.payload.refreshToken},loginFailure:(e,r)=>{e.isAuthenticated=!1,e.loading=!1,e.error=r.payload,e.user=null,e.accessToken=null,e.refreshToken=null},registerRequest:(e,r)=>{},refreshTokenRequest:(e,r)=>{},logoutRequest:e=>{e.loading=!0},logoutSuccess:e=>{e.isAuthenticated=!1,e.user=null,e.refreshToken=null,e.accessToken=null,e.loading=!1},loadAuthFromCookie:(e,r)=>{e.isAuthenticated=!0,e.user=r.payload.user,e.accessToken=r.payload.accessToken,e.refreshToken=r.payload.refreshToken}}}),{loginRequest:s,loginSuccess:t,loginFailure:a,registerRequest:l,refreshTokenRequest:c,logoutRequest:i,logoutSuccess:u,loadAuthFromCookie:d}=n.actions;r.ZP=n.reducer},5625:function(e,r,o){"use strict";o.d(r,{CG:function(){return t},TL:function(){return s},qr:function(){return a}});var n=o(828);let s=n.I0,t=n.v9,a=n.oR},6403:function(){}},function(e){e.O(0,[448,692,828,461,270,750,588,792,575,971,69,744],function(){return e(e.s=6709)}),_N_E=e.O()}]);